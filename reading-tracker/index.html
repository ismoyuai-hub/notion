<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Reading Tracker CN</title>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <style>
        :root {
            /* æ ¸å¿ƒå˜é‡ */
            --bg-color: transparent; /* é€æ˜èƒŒæ™¯ï¼Œå®Œç¾èå…¥ Notion */
            
            /* æµ…è‰²æ¨¡å¼ */
            --text-main: #373530;
            --text-sub: #787774;
            --square-empty: #e0e0e0;
            --square-active: #2ecc71; /* é²œè‰³çš„ç¿ ç»¿è‰² */
            --glow-color: rgba(46, 204, 113, 0.4); /* è§å…‰è‰² */
            --btn-bg: #f1f1ef;
            --btn-text: #373530;
            
            /* æ·±è‰²æ¨¡å¼å˜é‡å°†åœ¨ JS ä¸­åŠ¨æ€åˆ‡æ¢ */
        }

        /* æ·±è‰²æ¨¡å¼å¼ºåˆ¶è¦†ç›– */
        body.dark-mode {
            --text-main: #ffffff;
            --text-sub: #9b9b9b;
            --square-empty: #2f2f2f; /* æœªæ‰“å¡ï¼šæ·±ç°è‰²ï¼Œè¿‘ä¹èƒŒæ™¯ */
            --square-active: #00ff88; /* æ‰“å¡ï¼šèµ›åšæœ‹å…‹è§å…‰ç»¿ */
            --glow-color: rgba(0, 255, 136, 0.5);
            --btn-bg: #2c2c2c;
            --btn-text: #ffffff;
        }

        body {
            font-family: 'Inter', -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: transparent; /* å…³é”®ï¼šé€æ˜èƒŒæ™¯ */
            color: var(--text-main);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .container {
            width: 100%;
            max-width: 340px; /* é™åˆ¶å®½åº¦ï¼Œä¿æŒç²¾è‡´æ„Ÿ */
            padding: 24px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- 1. é¡¶éƒ¨æ•°æ®åŒº --- */
        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 4px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-sub);
            letter-spacing: 0.02em;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            line-height: 1;
            font-variant-numeric: tabular-nums;
        }

        /* --- 2. çƒ­åŠ›å›¾ç½‘æ ¼ --- */
        .grid-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 6px; /* æ ¼å­é—´è· */
            justify-content: flex-start; /* å·¦å¯¹é½ */
        }

        .day-square {
            width: 14px;
            height: 14px;
            background-color: var(--square-empty);
            border-radius: 4px; /* æ›´åœ†æ¶¦çš„è§’ */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* å¼¹æ€§åŠ¨ç”» */
            position: relative;
            cursor: default;
        }

        /* æ¿€æ´»çŠ¶æ€ï¼šå‘å…‰æ•ˆæœ */
        .day-square.active {
            background-color: var(--square-active);
            box-shadow: 0 0 8px var(--glow-color); /* è§å…‰æ•ˆæœæ ¸å¿ƒ */
            transform: scale(1.1); /* ç¨å¾®æ”¾å¤§ä¸€ç‚¹ç‚¹ */
            z-index: 1;
        }

        /* Tooltip æç¤ºæ—¥æœŸ */
        .day-square:hover::after {
            content: attr(data-date);
            position: absolute;
            bottom: 22px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 10;
            pointer-events: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-weight: 500;
        }

        /* --- 3. åº•éƒ¨æŒ‰é’® --- */
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
        }

        .today-btn {
            background: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s ease, background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            outline: none;
            user-select: none;
        }

        .today-btn:hover {
            filter: brightness(0.95); /* ç¨å¾®å˜æš— */
        }
        
        /* æŒ‰é’®ç‚¹å‡»æ—¶çš„ Q å¼¹åŠ¨ç”» */
        .today-btn:active {
            transform: scale(0.92); 
        }

        /* æ‰“å¡å®ŒæˆçŠ¶æ€çš„æŒ‰é’® */
        .today-btn.completed {
            background: rgba(46, 204, 113, 0.15); /* æ·¡æ·¡çš„ç»¿è‰²èƒŒæ™¯ */
            color: var(--square-active); /* æ–‡å­—å˜ç»¿ */
        }

        .date-display {
            font-size: 12px;
            color: var(--text-sub);
            font-weight: 500;
        }

        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="light-mode">

    <div class="container">
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-label">è¿ç»­æ‰“å¡</div>
                <div class="stat-value" id="streakVal">0</div>
            </div>
            <div class="stat-item" style="align-items: flex-end;">
                <div class="stat-label">ç´¯è®¡é˜…è¯»</div>
                <div class="stat-value" id="totalVal">0</div>
            </div>
        </div>

        <div class="grid-wrapper" id="grid">
            </div>

        <div class="footer">
            <button class="today-btn" id="checkInBtn" onclick="toggleCheckIn()">
                <span id="btnIcon">ğŸ“š</span>
                <span id="btnText">ä»Šæ—¥æ‰“å¡</span>
            </button>
            <div class="date-display" id="dateDisplay">...</div>
        </div>
    </div>

    <script>
        // --- é…ç½® ---
        const STORAGE_KEY = 'notion_reading_logs';
        const DAYS_SHOW = 84; // æ˜¾ç¤ºè¿‡å»çº¦3ä¸ªæœˆçš„æ ¼å­
        
        // --- æ ¸å¿ƒé€»è¾‘ ---

        function getLogs() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? new Set(JSON.parse(stored)) : new Set();
        }

        function saveLogs(logs) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify([...logs]));
        }

        function getTodayStr() {
            // è·å–å½“åœ°æ—¶é—´ YYYY-MM-DD
            const d = new Date();
            const offset = d.getTimezoneOffset() * 60000;
            const localDate = new Date(d.getTime() - offset);
            return localDate.toISOString().split('T')[0];
        }

        function toggleCheckIn() {
            const today = getTodayStr();
            const logs = getLogs();
            
            if (logs.has(today)) {
                logs.delete(today);
            } else {
                logs.add(today);
                // è§¦å‘éœ‡åŠ¨åé¦ˆ (å¦‚æœè®¾å¤‡æ”¯æŒ)
                if (navigator.vibrate) navigator.vibrate(50);
            }
            saveLogs(logs);
            render();
        }

        function calculateStats(logs) {
            let streak = 0;
            let checkDate = new Date();
            // å¦‚æœä»Šå¤©å·²æ‰“å¡ï¼Œä»ä»Šå¤©å¼€å§‹ç®—ï¼›å¦‚æœæ²¡æ‰“å¡ï¼Œä»æ˜¨å¤©å¼€å§‹ç®—
            const todayStr = getTodayStr();
            if (!logs.has(todayStr)) {
                checkDate.setDate(checkDate.getDate() - 1);
            }

            for (let i = 0; i < 365; i++) {
                const dateStr = checkDate.toISOString().split('T')[0];
                // ä¿®æ­£æ—¶åŒºåç§»å¯¼è‡´çš„æ—¥æœŸè®¡ç®—é—®é¢˜
                const offset = checkDate.getTimezoneOffset() * 60000;
                const localCheckDate = new Date(checkDate.getTime() - offset).toISOString().split('T')[0];

                if (logs.has(localCheckDate)) {
                    streak++;
                } else {
                    break;
                }
                checkDate.setDate(checkDate.getDate() - 1);
            }
            return { streak, total: logs.size };
        }

        // --- æ¸²æŸ“ ---
        function render() {
            const logs = getLogs();
            const todayStr = getTodayStr();
            const stats = calculateStats(logs);

            // 1. æ›´æ–°æ–‡å­—
            document.getElementById('streakVal').innerText = stats.streak;
            document.getElementById('totalVal').innerText = stats.total;

            // 2. æ›´æ–°æŒ‰é’®
            const btn = document.getElementById('checkInBtn');
            const btnText = document.getElementById('btnText');
            const btnIcon = document.getElementById('btnIcon');
            
            if (logs.has(todayStr)) {
                btn.classList.add('completed');
                btnText.innerText = "å·²å®Œæˆ";
                btnIcon.innerText = "âœ¨";
            } else {
                btn.classList.remove('completed');
                btnText.innerText = "ä»Šæ—¥æ‰“å¡";
                btnIcon.innerText = "ğŸ“š";
            }

            // 3. æ›´æ–°æ—¥æœŸ
            const now = new Date();
            const dateOptions = { month: 'long', day: 'numeric', weekday: 'short' };
            document.getElementById('dateDisplay').innerText = now.toLocaleDateString('zh-CN', dateOptions);

            // 4. ç”Ÿæˆçƒ­åŠ›å›¾
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            for (let i = DAYS_SHOW - 1; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const offset = d.getTimezoneOffset() * 60000;
                const dateStr = new Date(d.getTime() - offset).toISOString().split('T')[0];
                
                const square = document.createElement('div');
                square.className = 'day-square';
                square.dataset.date = dateStr;
                
                if (logs.has(dateStr)) {
                    square.classList.add('active');
                    // ä¸ºæœ€è¿‘çš„ä¸€ä¸ªæ‰“å¡æ·»åŠ å¼¹å‡ºåŠ¨ç”»
                    if (dateStr === todayStr) {
                        square.style.animation = 'pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    }
                }
                
                // å¦‚æœæ˜¯ä»Šå¤©ä½†æ²¡æ‰“å¡ï¼Œç»™ä¸€ä¸ªç‰¹æ®Šçš„è¾¹æ¡†æç¤ºï¼ˆå¯é€‰ï¼Œè¿™é‡Œä¿æŒç®€æ´æœªåŠ ï¼‰
                
                grid.appendChild(square);
            }
        }

        // --- ä¸»é¢˜è‡ªåŠ¨é€‚é… ---
        function applyTheme() {
            const urlParams = new URLSearchParams(window.location.search);
            const forceTheme = urlParams.get('theme');
            let isDark = false;
            
            if (forceTheme === 'dark') isDark = true;
            else if (forceTheme === 'light') isDark = false;
            else isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (isDark) {
                document.body.classList.add('dark-mode');
                document.body.classList.remove('light-mode');
            } else {
                document.body.classList.add('light-mode');
                document.body.classList.remove('dark-mode');
            }
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addListener(applyTheme);
        applyTheme();
        render();

    </script>
</body>
</html>